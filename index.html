<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>e-RPH Pro AI - Ustaz Muslim bin Ab.Llah</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Modern -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK Compat -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        /* Menggunakan keluarga fon Noto untuk keseragaman Jawi dan Rumi */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;700&family=Inter:wght@400;500;700&display=swap');

        @media print {
            body { background-color: white; }
            @page { margin: 1cm; }
            .no-print { display: none !important; }
        }
        .dir-rtl { direction: rtl; }
        .dir-ltr { direction: ltr; }
        
        /* Font Jawi diselaraskan */
        .font-jawi { 
            font-family: 'Noto Sans Arabic', Arial, sans-serif; 
            line-height: 2;
        }
        
        /* Font Rumi diselaraskan */
        .font-rumi {
            font-family: 'Inter', Arial, sans-serif;
            line-height: 1.6;
        }
        
        .input-auto { direction: inherit; }

        /* Custom Scrollbar for Admin Library */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #c7d2fe;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
          apiKey: "AIzaSyDoc2QdaZDWJ8_DVZIltxzEcOQiAAofH3E",
          authDomain: "rph-pendidkan-islam.firebaseapp.com",
          projectId: "rph-pendidkan-islam",
          storageBucket: "rph-pendidkan-islam.firebasestorage.app",
          messagingSenderId: "624470216657",
          appId: "1:624470216657:web:cb2fa2031edffc749a1af0"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'rph-pendidikan-islam-cg';

        // ============================================================================
        // DATA MASTER DSKP
        // ============================================================================
        const dskpData = {
          'PI': {
             '4': [
                { isJawi: true, tema: 'تلاوة', tajuk: 'سورة التكاثر', sk: '1.1 ممباچ دان مڠعملكن سورة التكاثر دڠن بتول.', sp: '1.1.1 ممباچ سورة التكاثر دڠن بتول دان برتجويد.', obj: 'ڤد اخير ڤڠاجرن موريد داڤت ممباچ سورة التكاثر اية 1-4 دڠن بتول دان لنجر.', akt: '1. ݢورو ممڤردڠركن باچاءن.\n2. لاتيه توبي مڽبوت كليمة.\n3. تسميع باچاءن سچارا برڤاسڠن.', bbm: 'رقمن تاليفون بيمبيت' }
             ],
             '5': [
                { isJawi: true, tema: 'تلاوة', tajuk: 'سورة القدر', sk: '1.1 ممباچ دان مڠعملكن سورة القدر دڠن بتول.', sp: '1.1.1 ممباچ سورة القدر دڠن بتول دان برتجويد.', obj: 'ڤد اخير ڤڠاجرن موريد داڤت ممباچ سورة القدر اية 1-5 دڠن بتول دان لنجر.', akt: '1. ݢورو ممڤردڠركن باچاءن.\n2. لاتيه توبي مڽبوت كليمة.\n3. تسميع باچاءن سچارا برڤاسڠن.', bbm: 'رقمن تاليفون بيمبيت' }
             ],
             '6': [
                { isJawi: true, tema: 'تلاوة', tajuk: 'سورة الشرح', sk: '1.1 ممباچ دان مڠعملكن سورة الشرح دڠن بتول.', sp: '1.1.1 ممباچ سورة الشرح دڠن بتول دان برتجويد.', obj: 'ڤد اخير ڤڠاجرن موريد داڤت ممباچ سورة الشرح اية 1-4 دڠن بتول.', akt: '1. ݢورو ممڤردڠركن باچاءن.\n2. لاتيه توبي ممباچ.\n3. تسميع باچاءن سچارا برڤاسڠن.', bbm: 'مصحف القرءان' }
             ],
             'Common': [
                { isJawi: true, tema: 'تسميع القرءان', tajuk: 'تسميع القرءان (مڠيكوت تاهڤ موريد)', sk: 'ممباچ القرءان / اقراء', sp: 'ممباچ القرءان مڠيكوت تاهڤ', obj: 'موريد داڤت ممباچ القرءان دڠن بتول دان برتجويد.', akt: '1. تلقي مشافهة.\n2. ممبتولكن باچاءن.\n3. ݢورو مريكود ڤنچاڤاين.', bbm: 'بوكو ريكود تسميع' },
                { isJawi: true, tema: 'ختم القرءان', tajuk: 'ختم القرءان (سورة ڤيليهن)', sk: 'ممباچ سورة ختام', sp: 'ممباچ سورة برداسركن جدوال', obj: 'موريد داڤت ممباچ سورة دڠن بتول.', akt: '1. تلقي مشافهة.\n2. بيمبيڠن راكن سباي.', bbm: 'مصحف القرءان' },
                { isJawi: true, tema: 'عقيدة', tajuk: 'نام الله الهادي دان العدل', sk: '3.1 ميقيني كونسيڤ نام الله الهادي دان العدل.', sp: '3.1.1 مڽاتاكن ڤڠرتين نام الله.', obj: 'موريد داڤت مڽاتاكن ڤڠرتين الهادي دڠن بتول.', akt: '1. ڤنرڠن ݢورو.\n2. لاتيه توبي.', bbm: 'بوكو تيكس' },
                { isJawi: true, tema: 'عبادة', tajuk: 'صلاة سنة عيد الفطر', sk: '4.1 مروموس كونسيڤ صلاة سنة.', sp: '4.1.1 مڽاتاكن مقصود صلاة سنة.', obj: 'موريد داڤت مڽاتاكن مقصود صلاة سنة عيد.', akt: '1. ڤنرڠن ݢورو.\n2. لاتيه توبي.', bbm: 'سلايد' }
             ]
          },
          'PSV': {
             '5': [
                { isJawi: false, tema: 'MENGGAMBAR', tajuk: 'UNIT 1: SI KANCIL MENAWAN (LUKISAN)', sk: '1.1 Bahasa Seni Visual', sp: '1.1.1 Menyatakan istilah dan pengertian bahasa seni visual.', obj: 'Murid dapat mencirikan bahasa seni visual pada karya lukisan.', akt: '1. Guru menunjuk contoh karya lukisan.\n2. Murid berbincang tentang bahasa seni (garisan, rupa).\n3. Murid membuat lakaran awal.', bbm: 'Buku Teks, Kertas Lukisan, Pensel' },
                { isJawi: false, tema: 'MEMBUAT CORAK', tajuk: 'UNIT 2: CORAK TERANCANG (CETAKAN)', sk: '2.1 Kemahiran Seni Visual', sp: '2.1.1 Meneroka media berpandukan bahasa seni visual.', obj: 'Murid dapat meneroka penggunaan media dalam teknik cetakan.', akt: '1. Murid menyediakan bahan alam semula jadi.\n2. Guru membimbing teknik cetakan.\n3. Murid menghasilkan karya.', bbm: 'Kertas lukisan, Warna air, Pelepah pisang/Bendi' }
             ],
             'Common': []
          }
        };

        const dskpTemplates = [];
        ['4', '5', '6'].forEach(tahun => {
          for (let minggu = 1; minggu <= 38; minggu++) {
            [...(dskpData.PI[tahun] || []), ...dskpData.PI.Common].forEach(t => {
              if (minggu === 1 && t.tema === 'عبادة') return; 
              dskpTemplates.push({ ...t, id: `pi-${tahun}-${t.tema}-${minggu}`, minggu: minggu.toString(), tahun, subjectKey: 'PI', tajuk: `${t.tajuk} (M${minggu})`, refleksi: '___ / ___ موريد منچاڤاي اوبجيكتيف. ___ موريد ممرلوكن بيمبيڠن.' });
            });
            [...(dskpData.PSV[tahun] || []), ...dskpData.PSV.Common].forEach(t => {
              dskpTemplates.push({ ...t, id: `psv-${tahun}-${t.tajuk}-${minggu}`, minggu: minggu.toString(), tahun, subjectKey: 'PSV', tajuk: `${t.tajuk} (M${minggu})`, refleksi: '___ / ___ murid mencapai objektif. ___ murid memerlukan bimbingan.' });
            });
          }
        });

        // JADUAL USTAZ
        const jadualWaktuUstaz = {
          'Ahad': [
            { masaMula: '08:15', masaTamat: '09:15', mataPelajaran: 'ڤنديديقن اسلام', kelas: '5 نيلوم', tahun: '5', sKey: 'PI' },
            { masaMula: '10:45', masaTamat: '11:45', mataPelajaran: 'Pendidikan Seni Visual', kelas: '5 Nilam', tahun: '5', sKey: 'PSV' },
            { masaMula: '11:45', masaTamat: '12:45', mataPelajaran: 'ڤنديديقن اسلام', kelas: '6 زمرود', tahun: '6', sKey: 'PI' }
          ],
          'Isnin': [
            { masaMula: '09:15', masaTamat: '10:15', mataPelajaran: 'تسميع', kelas: '6 زمرود', tahun: '6', sKey: 'PI' },
            { masaMula: '11:45', masaTamat: '12:45', mataPelajaran: 'ڤنديديقن اسلام', kelas: '6 زمرود', tahun: '6', sKey: 'PI' }
          ],
          'Selasa': [
            { masaMula: '07:45', masaTamat: '08:45', mataPelajaran: 'تسميع', kelas: '5 زمرود', tahun: '5', sKey: 'PI' },
            { masaMula: '08:45', masaTamat: '09:45', mataPelajaran: 'ڤنديديقن اسلام', kelas: '6 زمرود', tahun: '6', sKey: 'PI' }
          ],
          'Rabu': [
            { masaMula: '07:45', masaTamat: '08:45', mataPelajaran: 'تسميع', kelas: '4 زمرود', tahun: '4', sKey: 'PI' },
            { masaMula: '09:45', masaTamat: '10:45', mataPelajaran: 'ڤنديديقن اسلام', kelas: '6 زمرود', tahun: '6', sKey: 'PI' }
          ],
          'Khamis': [
            { masaMula: '07:45', masaTamat: '08:45', mataPelajaran: 'ڤنديديقن اسلام', kelas: '5 نيلوم', tahun: '5', sKey: 'PI' },
            { masaMula: '10:45', masaTamat: '11:45', mataPelajaran: 'تسميع', kelas: '4 ڤيروس', tahun: '4', sKey: 'PI' }
          ]
        };

        function App() {
          const [viewMode, setViewMode] = useState('guru');
          const [user, setUser] = useState(null);
          const [savedRphList, setSavedRphList] = useState([]);
          const [isSaving, setIsSaving] = useState(false);
          const [notifikasi, setNotifikasi] = useState('');
          const [subjectKey, setSubjectKey] = useState('PI');
          const [uploadStatus, setUploadStatus] = useState(null);

          // Simulated Uploaded Files List
          const [uploadedFiles, setUploadedFiles] = useState([
              { id: 1, name: 'tahun 4.pdf', size: '1.2 MB', date: '2026-03-01', status: 'Selesai Analisis' },
              { id: 2, name: 'tahun 5.pdf', size: '0.8 MB', date: '2026-03-01', status: 'Selesai Analisis' },
              { id: 3, name: 'tahun 6.pdf', size: '1.5 MB', date: '2026-02-28', status: 'Selesai Analisis' },
              { id: 4, name: 'psv tahun 5.pdf', size: '2.1 MB', date: '2026-03-01', status: 'Selesai Analisis' }
          ]);

          const [formData, setFormData] = useState({
            isJawi: true, tahun: '6', minggu: '1', tarikh: new Date().toISOString().split('T')[0],
            hari: 'Ahad', masaMula: '08:15', masaTamat: '09:15', kelas: '6 زمرود',
            mataPelajaran: 'ڤنديديقن اسلام', tema: '', tajuk: '',
            standardKandungan: '', standardPembelajaran: '', objektif: '', aktiviti: '', bbm: '', 
            refleksi: '___ / ___ موريد منچاڤاي اوبجيكتيف. ___ موريد ممرلوكن بيمبيڠن.'
          });

          useEffect(() => {
            auth.signInAnonymously().catch(e => console.error(e));
            const unsubscribe = auth.onAuthStateChanged(u => setUser(u));
            return () => unsubscribe();
          }, []);

          useEffect(() => {
            if (!user) return;
            const rphRef = db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('rekod_rph');
            const unsubscribe = rphRef.onSnapshot((snap) => {
              const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
              data.sort((a, b) => {
                  const tA = (a.createdAt && typeof a.createdAt.toMillis === 'function') ? a.createdAt.toMillis() : 0;
                  const tB = (b.createdAt && typeof b.createdAt.toMillis === 'function') ? b.createdAt.toMillis() : 0;
                  return tB - tA;
              });
              setSavedRphList(data);
            });
            return () => unsubscribe();
          }, [user]);

          const handleInputChange = (e) => {
            const { name, value } = e.target;
            setFormData(prev => ({ ...prev, [name]: value }));
          };

          const handleApplyTemplate = (e) => {
            const templateId = e.target.value;
            if (!templateId) return;
            const t = dskpTemplates.find(x => x.id === templateId);
            if (t) {
              setFormData(prev => ({ 
                ...prev, isJawi: t.isJawi, tema: t.tema, tajuk: t.tajuk, 
                standardKandungan: t.sk || '', standardPembelajaran: t.sp || '', 
                objektif: t.obj || '', aktiviti: t.akt || '', 
                bbm: t.bbm || '', refleksi: t.refleksi
              }));
              tunjukNotifikasi(`Bidang ${t.tema} dimasukkan!`);
            }
            e.target.value = "";
          };

          const handleApplyJadual = (slot) => {
            setSubjectKey(slot.sKey);
            setFormData(prev => ({ 
                ...prev, ...slot, isJawi: slot.sKey === 'PI',
                refleksi: slot.sKey === 'PI' ? '___ / ___ موريد منچاڤاي اوبجيكتيف. ___ موريد ممرلوكن بيمبيڠن.' : '___ / ___ murid mencapai objektif. ___ murid memerlukan bimbingan.'
            }));
            tunjukNotifikasi(`${slot.mataPelajaran} dipilih!`);
          };

          const handleSaveFirestore = async () => {
            if (!user) return tunjukNotifikasi('Sila tunggu...');
            setIsSaving(true);
            try {
              await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('rekod_rph').add({
                ...formData, createdAt: firebase.firestore.FieldValue.serverTimestamp()
              });
              tunjukNotifikasi('Berjaya disimpan!');
            } catch (e) { tunjukNotifikasi('Gagal menyimpan.'); }
            setIsSaving(false);
          };

          const handleDelete = async (id) => {
            try {
              await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('rekod_rph').doc(id).delete();
              tunjukNotifikasi('Dihapuskan.');
            } catch (e) { console.error(e); }
          };

          const tunjukNotifikasi = (m) => {
            setNotifikasi(m);
            setTimeout(() => setNotifikasi(''), 3000);
          };

          const handleFileUpload = (e) => {
              const file = e.target.files[0];
              if (file) {
                  setUploadStatus(`Menganalisis ${file.name}...`);
                  setTimeout(() => {
                      const newFile = {
                          id: Date.now(),
                          name: file.name,
                          size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                          date: new Date().toISOString().split('T')[0],
                          status: 'Selesai Analisis'
                      };
                      setUploadedFiles([newFile, ...uploadedFiles]);
                      setUploadStatus('Selesai! Tajuk baharu ditambah ke pangkalan data.');
                      setTimeout(() => setUploadStatus(null), 3000);
                  }, 2000);
              }
          };

          const handleCetak = () => window.print();

          const jadualHariIni = jadualWaktuUstaz[formData.hari] || [];
          
          const inputStyle = `border p-3 rounded-xl w-full input-auto focus:ring-2 focus:ring-indigo-500 outline-none transition-colors shadow-sm ${formData.isJawi ? 'dir-rtl font-jawi text-base' : 'dir-ltr font-rumi text-sm'}`;

          return (
            <div className={`min-h-screen pb-10 font-rumi`}>
              <header className="bg-indigo-800 text-white p-4 shadow-lg flex justify-between items-center no-print sticky top-0 z-50">
                <div className="flex items-center gap-3">
                  <i className="fas fa-palette text-2xl"></i>
                  <h1 className="text-xl font-bold tracking-tighter italic">e-RPH Pro AI</h1>
                </div>
                <div className="flex items-center gap-4">
                  {notifikasi && <span className="bg-emerald-500 px-3 py-1 rounded text-sm animate-pulse">{notifikasi}</span>}
                  <div className="bg-indigo-900 rounded p-1 flex text-xs font-bold">
                    <button onClick={()=>setViewMode('guru')} className={`px-4 py-1.5 rounded transition-all ${viewMode==='guru'?'bg-white text-indigo-800 shadow-sm':'text-indigo-200'}`}>Guru</button>
                    <button onClick={()=>setViewMode('admin')} className={`px-4 py-1.5 rounded transition-all ${viewMode==='admin'?'bg-red-500 text-white shadow-sm':'text-indigo-200'}`}>Admin</button>
                  </div>
                  <span className="text-sm font-semibold"><i className="fas fa-user-circle mr-1"></i> Ustaz Muslim bin Ab.Llah</span>
                </div>
              </header>

              <main className="max-w-7xl mx-auto mt-6 px-4">
                {viewMode === 'admin' ? (
                  <div className="space-y-6 max-w-4xl mx-auto">
                    <div className="bg-white p-8 rounded-2xl shadow-xl border border-indigo-50 text-center">
                        <div className="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i className="fas fa-cloud-upload-alt text-2xl text-indigo-600"></i>
                        </div>
                        <h2 className="text-xl font-bold mb-1">Muat Naik DSKP</h2>
                        <p className="text-slate-500 text-sm mb-6 leading-relaxed">Muat naik PDF baru untuk subjek Pendidikan Islam atau PSV.</p>
                        <label className="border-2 border-dashed p-10 block rounded-2xl cursor-pointer hover:bg-slate-50 border-indigo-200 transition-all group">
                            <i className="fas fa-file-pdf text-4xl text-red-400 mb-3 group-hover:scale-110 transition-transform"></i>
                            <span className="block font-bold text-indigo-700">Pilih Fail PDF</span>
                            <input type="file" className="hidden" accept="application/pdf" onChange={handleFileUpload}/>
                        </label>
                        {uploadStatus && <div className="mt-4 p-3 bg-indigo-50 text-indigo-700 text-xs rounded-xl flex items-center justify-center gap-2"><i className="fas fa-spinner fa-spin"></i> {uploadStatus}</div>}
                    </div>

                    <div className="bg-white p-8 rounded-2xl shadow-xl border border-slate-100">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-lg font-bold flex items-center gap-2"><i className="fas fa-book-medical text-indigo-500"></i> Pustaka Dokumen DSKP</h2>
                            <span className="text-xs font-bold text-slate-400 uppercase tracking-widest">{uploadedFiles.length} FAIL TERSEDIA</span>
                        </div>
                        
                        <div className="overflow-x-auto custom-scroll">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-slate-50 text-slate-400 font-bold text-[10px] uppercase">
                                    <tr>
                                        <th className="px-4 py-3">Nama Dokumen</th>
                                        <th className="px-4 py-3 text-center">Saiz</th>
                                        <th className="px-4 py-3 text-center">Tarikh</th>
                                        <th className="px-4 py-3 text-center">Status AI</th>
                                        <th className="px-4 py-3 text-right">Tindakan</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {uploadedFiles.map(file => (
                                        <tr key={file.id} className="hover:bg-indigo-50/30 transition-colors">
                                            <td className="px-4 py-4 font-bold text-slate-700 flex items-center gap-3">
                                                <i className="fas fa-file-pdf text-red-500"></i> {file.name}
                                            </td>
                                            <td className="px-4 py-4 text-center text-slate-500">{file.size}</td>
                                            <td className="px-4 py-4 text-center text-slate-500">{file.date}</td>
                                            <td className="px-4 py-4 text-center">
                                                <span className="px-2 py-1 bg-emerald-100 text-emerald-700 text-[10px] font-bold rounded-full">{file.status}</span>
                                            </td>
                                            <td className="px-4 py-4 text-right">
                                                <button onClick={() => tunjukNotifikasi('Pratonton PDF tidak tersedia dalam mod luar talian.')} className="text-indigo-600 hover:text-indigo-800 font-bold text-xs"><i className="fas fa-external-link-alt mr-1"></i> Lihat</button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 print:block">
                    {/* INPUT SIDE */}
                    <div className="lg:col-span-5 space-y-6 no-print">
                      <div className="bg-white p-6 rounded-2xl shadow-sm border border-indigo-50">
                        <h2 className="font-bold text-indigo-800 mb-4 uppercase tracking-tighter text-sm flex items-center"><i className="fas fa-calendar-check mr-2"></i>Langkah 1: Tetapan Asas</h2>
                        <div className="grid grid-cols-3 gap-3 mb-4">
                          <div>
                            <label className="block text-xs font-bold text-slate-400 mb-1">Tahun</label>
                            <select name="tahun" value={formData.tahun} onChange={handleInputChange} className="w-full border p-2.5 rounded-xl bg-slate-50 text-sm font-bold focus:ring-2 focus:ring-indigo-500 outline-none">
                              <option value="4">4</option><option value="5">5</option><option value="6">6</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-400 mb-1">Minggu</label>
                            <select name="minggu" value={formData.minggu} onChange={handleInputChange} className="w-full border p-2.5 rounded-xl bg-slate-50 text-sm font-bold focus:ring-2 focus:ring-indigo-500 outline-none">
                              {Array.from({length:38},(_,i)=>i+1).map(m=><option key={m} value={m}>{m}</option>)}
                            </select>
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-400 mb-1">Hari</label>
                            <select name="hari" value={formData.hari} onChange={handleInputChange} className="w-full border p-2.5 rounded-xl bg-slate-50 text-sm font-bold focus:ring-2 focus:ring-indigo-500 outline-none">
                              {['Ahad','Isnin','Selasa','Rabu','Khamis'].map(h=><option key={h} value={h}>{h}</option>)}
                            </select>
                          </div>
                        </div>
                        {jadualHariIni.length > 0 && (
                          <div className="border-t pt-4">
                            <label className="block text-xs font-bold text-slate-400 mb-2 italic">Jadual Ustaz:</label>
                            <div className="grid grid-cols-1 gap-2">
                                {jadualHariIni.map((s,i)=> (
                                    <button key={i} onClick={()=>handleApplyJadual(s)} className="text-left p-3 rounded-xl border border-indigo-100 hover:bg-indigo-600 hover:text-white transition-all text-sm font-semibold flex justify-between group">
                                        <span>{s.mataPelajaran} ({s.kelas})</span>
                                        <span className="text-indigo-400 group-hover:text-indigo-200 text-xs">{s.masaMula}</span>
                                    </button>
                                ))}
                            </div>
                          </div>
                        )}
                      </div>

                      <div className="bg-white p-6 rounded-2xl shadow-sm border border-emerald-50">
                        <h2 className="font-bold text-emerald-800 mb-4 uppercase tracking-tighter text-sm flex items-center"><i className="fas fa-magic mr-2"></i>Langkah 2: Pilih Bidang (AI)</h2>
                        <select onChange={handleApplyTemplate} className="w-full border-2 border-emerald-400 p-3.5 rounded-xl font-bold text-emerald-900 bg-white shadow-sm focus:ring-2 focus:ring-emerald-500 outline-none">
                          <option value="">-- Pilih Tajuk DSKP ({subjectKey}) --</option>
                          {dskpTemplates
                            .filter(t=>t.minggu===formData.minggu.toString() && t.tahun===formData.tahun.toString() && t.subjectKey === subjectKey)
                            .map(t=>(
                                <option key={t.id} value={t.id}>[{t.tema}] {t.tajuk}</option>
                          ))}
                        </select>
                      </div>

                      <div className="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 className="font-bold text-slate-800 mb-4 uppercase tracking-tighter text-sm flex items-center"><i className="fas fa-edit mr-2"></i>Langkah 3: Semakan Isi</h2>
                        <div className="space-y-4 text-sm">
                          <div className="grid grid-cols-2 gap-3">
                            <input type="text" name="tema" value={formData.tema} onChange={handleInputChange} placeholder="Bidang" className={`${inputStyle} font-bold text-indigo-700`}/>
                            <input type="text" name="tajuk" value={formData.tajuk} onChange={handleInputChange} placeholder="Tajuk" className={`${inputStyle} font-bold`}/>
                          </div>
                          <textarea name="standardKandungan" rows="2" value={formData.standardKandungan} onChange={handleInputChange} placeholder="SK" className={inputStyle}></textarea>
                          <textarea name="standardPembelajaran" rows="2" value={formData.standardPembelajaran} onChange={handleInputChange} placeholder="SP" className={inputStyle}></textarea>
                          <textarea name="objektif" rows="3" value={formData.objektif} onChange={handleInputChange} placeholder="Objektif" className={inputStyle}></textarea>
                          <textarea name="aktiviti" rows="5" value={formData.aktiviti} onChange={handleInputChange} placeholder="Aktiviti" className={inputStyle}></textarea>
                          <input type="text" name="bbm" value={formData.bbm} onChange={handleInputChange} placeholder="BBM" className={inputStyle}/>
                          <textarea name="refleksi" rows="2" value={formData.refleksi} onChange={handleInputChange} placeholder="Refleksi" className={inputStyle}></textarea>
                        </div>
                        <div className="flex gap-3 mt-6">
                          <button onClick={handleSaveFirestore} disabled={isSaving} className="flex-1 bg-indigo-600 text-white py-3.5 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-md active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2">
                            <i className="fas fa-save"></i> {isSaving ? 'Menyimpan...':'Simpan RPH'}
                          </button>
                          <button onClick={handleCetak} className="bg-slate-800 text-white px-6 py-3.5 rounded-xl font-bold hover:bg-slate-900 transition-all shadow-md active:scale-95 flex items-center justify-center gap-2">
                            <i className="fas fa-print"></i> Cetak / PDF
                          </button>
                        </div>
                      </div>

                      <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h2 className="font-bold text-slate-400 mb-4 uppercase tracking-tighter text-[10px] flex items-center justify-between">
                            <span>Arkib RPH Saya</span>
                            <span className="bg-slate-100 px-2 py-0.5 rounded text-slate-500">{savedRphList.length} rekod</span>
                        </h2>
                        <div className="max-h-80 overflow-y-auto space-y-2 pr-2">
                          {savedRphList.map(r=>(
                            <div key={r.id} className="flex justify-between items-center p-3 border border-slate-100 rounded-xl hover:bg-slate-50 text-xs transition-colors group">
                              <div onClick={()=>setFormData(r)} className="cursor-pointer flex-1">
                                <div className={`font-bold text-slate-700 group-hover:text-indigo-600 ${r.isJawi ? 'dir-rtl font-jawi text-base' : 'dir-ltr font-rumi text-sm'}`}>{r.tema} : M{r.minggu}</div>
                                <div className="text-slate-400 mt-1 flex gap-2 font-rumi text-xs"><span>{r.tarikh}</span> <span>•</span> <span>{r.kelas}</span></div>
                              </div>
                              <button onClick={()=>handleDelete(r.id)} className="text-slate-300 hover:text-red-500 transition-colors p-2"><i className="fas fa-trash-alt"></i></button>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>

                    {/* PREVIEW SIDE (A4) - Memenuhi 1 Kertas A4 menggunakan Flexbox */}
                    <div className="lg:col-span-7 bg-white p-12 shadow-2xl border min-h-[1100px] print:min-h-[26cm] print:flex print:flex-col relative print:p-0 print:shadow-none print:border-none print:m-0">
                      <div className="absolute top-0 right-0 p-2 bg-slate-800 text-white text-[10px] uppercase font-bold no-print rounded-bl">Pratonton Kertas A4</div>
                      
                      <div className="text-center border-b-2 border-slate-800 pb-6 mb-8 print:pb-4 print:mb-6 flex flex-col items-center justify-center relative">
                        <img src="logo.png?v=3" className="w-24 h-24 mb-2 object-contain print:w-20 print:h-20 print:mb-1" alt="Logo" onError={(e)=>e.target.style.display='none'} />
                        <h1 className="text-2xl print:text-xl font-bold uppercase tracking-widest text-slate-900">Rancangan Pelajaran Harian</h1>
                        <p className="text-md print:text-sm font-bold text-slate-600 mt-1 uppercase">SK PERMAISURI NUR ZAHIRAH</p>
                        <div className="mt-4 print:mt-2 px-6 py-1.5 print:py-0.5 border-2 border-slate-800 font-bold uppercase text-sm print:text-xs inline-block">
                            {formData.mataPelajaran} (TAHUN {formData.tahun})
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-x-10 gap-y-4 print:gap-y-3 mb-8 print:mb-6 text-sm print:text-sm border-b pb-6 print:pb-4 font-bold">
                        <div className="flex border-b border-slate-200 pb-1.5 print:pb-1 items-center justify-between"><span>{formData.minggu}</span><span className="text-slate-400 text-xs uppercase">Minggu</span></div>
                        <div className="flex border-b border-slate-200 pb-1.5 print:pb-1 items-center justify-between"><span>{formData.tarikh} ({formData.hari})</span><span className="text-slate-400 text-xs uppercase">Tarikh</span></div>
                        <div className="flex border-b border-slate-200 pb-1.5 print:pb-1 items-center justify-between"><span>{formData.masaMula} - {formData.masaTamat}</span><span className="text-slate-400 text-xs uppercase">Masa</span></div>
                        <div className="flex border-b border-slate-200 pb-1.5 print:pb-1 items-center justify-between"><span>{formData.kelas}</span><span className="text-slate-400 text-xs uppercase">Kelas</span></div>
                        <div className="flex border-b border-slate-200 pb-1.5 print:pb-1 items-center justify-between col-span-2"><span>____ / ____ Murid</span><span className="text-slate-400 text-xs uppercase">Kehadiran</span></div>
                      </div>

                      {/* Content Area dengan keupayaan Flex-1 untuk mengisi baki ruang pada kertas A4 */}
                      <div className={`space-y-6 print:space-y-5 text-sm print:flex-1 print:flex print:flex-col ${formData.isJawi ? 'font-jawi text-base print:text-lg' : 'font-rumi text-sm print:text-base'}`}>
                        <div className="grid grid-cols-12 gap-4 print:gap-2">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs pt-1 dir-ltr font-rumi">Bidang</div>
                            <div className={`col-span-9 font-bold text-xl print:text-xl text-indigo-900 ${formData.isJawi ? 'dir-rtl' : 'dir-ltr'}`}>{formData.tema || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 print:gap-2">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs pt-1 dir-ltr font-rumi">Tajuk</div>
                            <div className={`col-span-9 font-bold text-lg print:text-lg ${formData.isJawi ? 'dir-rtl' : 'dir-ltr'}`}>{formData.tajuk || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 print:gap-2 bg-slate-50 p-5 print:p-0 rounded-xl print:bg-transparent print:border-b-0">
                            <div className="col-span-3 font-bold text-xs uppercase text-slate-400 pt-1 dir-ltr font-rumi">Standard Kandungan</div>
                            <div className={`col-span-9 whitespace-pre-line ${formData.isJawi ? 'dir-rtl' : 'dir-ltr'}`}>{formData.standardKandungan || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 print:gap-2 bg-slate-50 p-5 print:p-0 rounded-xl print:bg-transparent print:border-b-0">
                            <div className="col-span-3 font-bold text-xs uppercase text-slate-400 pt-1 dir-ltr font-rumi">Standard Pembelajaran</div>
                            <div className={`col-span-9 whitespace-pre-line ${formData.isJawi ? 'dir-rtl' : 'dir-ltr'}`}>{formData.standardPembelajaran || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 print:gap-2">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs pt-1 dir-ltr font-rumi">Objektif</div>
                            <div className={`col-span-9 whitespace-pre-line font-medium ${formData.isJawi ? 'dir-rtl' : 'dir-ltr'}`}>{formData.objektif || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 print:gap-2 border-t border-slate-100 pt-6 print:pt-4">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs pt-1 dir-ltr font-rumi">Aktiviti PdP</div>
                            <div className={`col-span-9 whitespace-pre-line ${formData.isJawi ? 'dir-rtl' : 'dir-ltr'}`}>{formData.aktiviti || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 print:gap-2 border-t border-slate-100 pt-6 print:pt-4">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs pt-1 dir-ltr font-rumi">BBM</div>
                            <div className={`col-span-9 font-medium ${formData.isJawi ? 'dir-rtl' : 'dir-ltr'}`}>{formData.bbm || '-'}</div>
                        </div>
                        
                        {/* KOTAK REFLEKSI - Menggunakan print:flex-1 untuk merentang ke bawah memenuhkan muka surat */}
                        <div className="mt-12 print:mt-6 border-t border-slate-100 pt-6 print:pt-6 min-h-[120px] print:flex-1">
                            <h3 className="font-bold text-xs uppercase text-slate-400 tracking-widest dir-ltr font-rumi mb-3 print:mb-2">Refleksi / Catatan</h3>
                            <p className={`italic text-slate-700 whitespace-pre-line ${formData.isJawi ? 'dir-rtl' : 'dir-ltr'}`}>{formData.refleksi || 'Tiada catatan.'}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </main>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

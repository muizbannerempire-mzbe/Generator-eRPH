<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>e-RPH Pro AI - SK Permaisuri Nur Zahirah</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Modern (@babel/standalone) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK Compat -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        @media print {
            body { background-color: white; }
            @page { margin: 1cm; }
            .no-print { display: none !important; }
        }
        .dir-rtl { direction: rtl; }
        .dir-ltr { direction: ltr; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============================================================================
        // KONFIGURASI FIREBASE CIKGU
        // ============================================================================
        const firebaseConfig = {
          apiKey: "AIzaSyDoc2QdaZDWJ8_DVZIltxzEcOQiAAofH3E",
          authDomain: "rph-pendidkan-islam.firebaseapp.com",
          projectId: "rph-pendidkan-islam",
          storageBucket: "rph-pendidkan-islam.firebasestorage.app",
          messagingSenderId: "624470216657",
          appId: "1:624470216657:web:cb2fa2031edffc749a1af0"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'rph-pendidikan-islam-cg';

        // ============================================================================
        // DATA MASTER DSKP
        // ============================================================================
        const dskpMasterData = [
          {
            id: 'pi-tilawah',
            mataPelajaran: 'Pendidikan Islam',
            tema: 'تلاوة',
            tajuk: 'سُورَةُ الشرح',
            standardKandungan: '1.1 ممباچ دان مغعملكن سُورَةُ الشَّرح دغن بتول دان بر تجويد دالم کهیدوفن هارین سچارا برادب دان استقامة.',
            standardPembelajaran: '1.1.1 ممباح سُورَةُ الشَّرح دغن بتول دان برتجوید.\n1.1.2 ممباح القرءان دالم کهیدوفن هارین سچارا برادب دان استقامة.',
            objektif: 'قد أخير فغاجرن دان قمبلاجرن مورید دافت:\n1. ممباح سُورَةُ الشَّرح اية 4-1 دغن بتول دان لنجر.\n2. ممباح سُورَةُ الشَّرح اية 4-1 dغن بتول دان برتجوید.',
            aktiviti: 'فرمولان: گورو ممفرد غرکن با جاءن سُورَةُ الشَّرح.\nاوتام:\n1. لاتيه توبی ممباچ / ميبوت كلمة فوتوغن اية.\n2. تسميع باچاءن سجارا برفاسٹن.\n3. برسؤال جواب چارا باچان باكي كلمة ٢ ترتنتو.\nفنوتوف: ممفرد غرکن با چاءن سوره.',
            bbm: 'رقمن تيليفون بيمبيت، مصحف القرءان'
          },
          {
            id: 'pi-khatam', 
            mataPelajaran: 'Pendidikan Islam',
            tema: 'ختم القرءان',
            tajuk: 'سُورَةُ الزخرف اية 1-52',
            standardKandungan: 'سُورَةُ الزخرف اية 1-52',
            standardPembelajaran: 'ممباح سُورَةُ الزّخرُف اية 1-52',
            objektif: 'قد أخير فغاجرن دان قمبلاجرن مورید دافت:\n1. ممباح فوتوغن اية 1-52 سُورَةُ الزخرف دغن بيمبيغن كورو.\n2. ممباح سُورَةُ الزّخرُf اية 1-52 دغن بتول دان برتجويد.',
            aktiviti: 'فرمولأن: ممباچ اية سجارا تلقي دان مشافهة.\nاوتام:\n1. ممبتولكن باچاءن يغ كورغ فصيح.\n2. ممبيمبيغ راكن سباي.\n3. گورو مریکود فنچاقاین مورید.\nفنوتوف: روموسن دان لاتيهن برتوليس.',
            bbm: 'مصحف القرءان'
          },
          {
            id: 'pi-tasmik',
            mataPelajaran: 'Tasmik',
            tema: 'تسميع القرءان',
            tajuk: 'تسميع القرءان (مغيكوت تاهف موريد)',
            standardKandungan: 'ممباح القرءان / اقراء',
            standardPembelajaran: 'ممباح القرءan / اقراء مغيكوت تاهف باچاءن',
            objektif: 'قد أخير فغاجرن دان قمبلاجرن مورید دافت:\n1. ممباح القرءان / اقراء مغيكوت تاهف باچاءن موريد دغن بتول دان برتجوid.',
            aktiviti: 'فرمولأن: ممباچ اية سجارا تلقي دان مشافهة.\nاوتام:\n1. ممبتولكن باچاءن يغ كورغ فصيح.\n2. ممبيمبيغ راكن سباي.\n3. گورو مریکود فنچاقاین مورید دالم بوكو ريكود.\nفنوتوف: فنيلاين.',
            bbm: 'مصحف القرءان، اقراء، بوکو ریکود تسميع'
          },
          {
            id: 'pi-aqidah',
            mataPelajaran: 'Pendidikan Islam',
            tema: 'عقيدة',
            tajuk: 'نام الله الهادي دان الْعَدْل',
            standardKandungan: '3.1 ميقيني كونسيف نام الله الهادي دان العدل.',
            standardPembelajaran: '3.1.1 مپاتاکن فغرتين نام الله الهادي دان العدل.',
            objektif: 'قد أخير فغاجرن دان قمبلاجرن مورید دافت مپاتاکن فغرتين الهادي دغن بتول.',
            aktiviti: 'فرمولأن: سومبغ سارن اف یغ فرلو دلاکوکن اقابیla ترسست جالن.\nاوتام:\n1. گورو melاتیه توبی ميبوت فغرتين.\n2. لاتيه توبي ممباچ دليل نقلي دان ارتين.\nفنوتوف: روموسن.',
            bbm: 'بوکو تکس، کرتس مهجوغ'
          },
          {
            id: 'pi-ibadah',
            mataPelajaran: 'Pendidikan Islam',
            tema: 'عبادة',
            tajuk: 'صلاة سنة عيد الفطر دان عيد الأضحى',
            standardKandungan: '4.1 مروموس کونسيف صلاة سنة عيد الفطر دان عيد الأضحى.',
            standardPembelajaran: '4.1.1 مپاتاکن مقصود صلاة سنة عيد الفطر دان عيد الأضحى.',
            objektif: 'قد أخير فغاجرن مورید دافت مپاتاکن مقصود صلاة سنة عيد دغن تفت.',
            aktiviti: 'فرمولأن: برسؤال جواب فغالمن موريد مپمبوت هاري راي.\nاوتام:\n1. فنرغن گورو تنتغ مقصود دان حکوم.\n2. لاتيه توبي ميبوت مقصود صلاة سنة.\nفنوتوف: روموسن.',
            bbm: 'سلايد، کرتس مهجوغ'
          },
          {
            id: 'pi-jawi',
            mataPelajaran: 'Pendidikan Islam',
            tema: 'جاوي',
            tajuk: 'ساءين س دان تيكنولوكي فماچو ماس ها دفن',
            standardKandungan: '7.1 ممباچ ممبینا دان منوليس فلباكاي جنيس تيك س.',
            standardPembelajaran: '7.1.1 ممباچ تيك س بردا سركن تيما.',
            objektif: 'قد أخير فغاجرن مورید دافت ممباچ تيك س جاوي دغن بتول.',
            aktiviti: 'فرمولأن: سومیغ سارن چونتوه چیفتع من ساءین س دان تيكنولوكي.\nاوتام:\n1. كورو بيمبيغ ممباچ تيك س.\n2. كورو مغلواركن فركاتاءن ترتنتو.\nفنوتوف: روموسن.',
            bbm: 'لمبرن کرجا'
          }
        ];

        const dskpTemplates = [];
        ['4', '5', '6'].forEach(tahun => {
          for (let minggu = 1; minggu <= 38; minggu++) {
            dskpMasterData.forEach(template => {
              if (minggu === 1 && template.id === 'pi-ibadah') return; 
              dskpTemplates.push({
                ...template,
                id: `t${tahun}-${template.id}-m${minggu}`,
                minggu: minggu.toString(),
                tahun: tahun,
                tajuk: minggu === 1 ? `${template.tajuk} (Tahun ${tahun})` : `${template.tajuk} (M${minggu}-Tahun ${tahun})`,
                refleksi: '___ / ___ murid mencapai objektif. ___ murid memerlukan bimbingan.'
              });
            });
          }
        });

        const jadualWaktuCgMuslim = {
          'Ahad': [
            { masaMula: '08:15', masaTamat: '09:15', mataPelajaran: 'Pendidikan Islam', kelas: '5 Nilam', tahun: '5' },
            { masaMula: '10:45', masaTamat: '11:45', mataPelajaran: 'Pendidikan Seni Visual', kelas: '5 Nilam', tahun: '5' },
            { masaMula: '11:45', masaTamat: '12:45', mataPelajaran: 'Pendidikan Islam', kelas: '6 Zamrud', tahun: '6' }
          ],
          'Isnin': [
            { masaMula: '09:15', masaTamat: '10:15', mataPelajaran: 'Tasmik', kelas: '6 Zamrud', tahun: '6' },
            { masaMula: '11:45', masaTamat: '12:45', mataPelajaran: 'Pendidikan Islam', kelas: '6 Zamrud', tahun: '6' },
            { masaMula: '12:45', masaTamat: '13:15', mataPelajaran: 'Pendidikan Islam', kelas: '5 Nilam', tahun: '5' }
          ],
          'Selasa': [
            { masaMula: '07:45', masaTamat: '08:45', mataPelajaran: 'Tasmik', kelas: '5 Zamrud', tahun: '5' },
            { masaMula: '08:45', masaTamat: '09:45', mataPelajaran: 'Pendidikan Islam', kelas: '6 Zamrud', tahun: '6' },
            { masaMula: '10:45', masaTamat: '11:45', mataPelajaran: 'Tasmik', kelas: '5 Nilam', tahun: '5' }
          ],
          'Rabu': [
            { masaMula: '07:45', masaTamat: '08:45', mataPelajaran: 'Tasmik', kelas: '4 Zamrud', tahun: '4' },
            { masaMula: '09:45', masaTamat: '10:45', mataPelajaran: 'Pendidikan Islam', kelas: '6 Zamrud', tahun: '6' },
            { masaMula: '10:45', masaTamat: '11:45', mataPelajaran: 'Tasmik', kelas: '4 Nilam', tahun: '4' },
            { masaMula: '11:45', masaTamat: '12:45', mataPelajaran: 'Pendidikan Islam', kelas: '5 Nilam', tahun: '5' }
          ],
          'Khamis': [
            { masaMula: '07:45', masaTamat: '08:45', mataPelajaran: 'Pendidikan Islam', kelas: '5 Nilam', tahun: '5' },
            { masaMula: '10:45', masaTamat: '11:45', mataPelajaran: 'Tasmik', kelas: '4 Pirus', tahun: '4' },
            { masaMula: '12:15', masaTamat: '13:15', mataPelajaran: 'Pendidikan Islam', kelas: '4 Zamrud', tahun: '4' }
          ]
        };

        function App() {
          const [viewMode, setViewMode] = useState('guru');
          const [user, setUser] = useState(null);
          const [savedRphList, setSavedRphList] = useState([]);
          const [isSaving, setIsSaving] = useState(false);
          const [notifikasi, setNotifikasi] = useState('');
          const [uploadStatus, setUploadStatus] = useState(null);

          const [formData, setFormData] = useState({
            tahun: '6', minggu: '1', tarikh: new Date().toISOString().split('T')[0],
            hari: 'Ahad', masaMula: '08:15', masaTamat: '09:15', kelas: '6 Zamrud',
            mataPelajaran: 'Pendidikan Islam', tema: '', tajuk: '',
            standardKandungan: '', standardPembelajaran: '', objektif: '', aktiviti: '', bbm: '', refleksi: ''
          });

          useEffect(() => {
            auth.signInAnonymously().catch(e => console.error(e));
            const unsubscribe = auth.onAuthStateChanged(u => setUser(u));
            return () => unsubscribe();
          }, []);

          useEffect(() => {
            if (!user) return;
            const rphRef = db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('rekod_rph');
            const unsubscribe = rphRef.onSnapshot((snap) => {
              const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
              data.sort((a, b) => {
                  const tA = (a.createdAt && typeof a.createdAt.toMillis === 'function') ? a.createdAt.toMillis() : 0;
                  const tB = (b.createdAt && typeof b.createdAt.toMillis === 'function') ? b.createdAt.toMillis() : 0;
                  return tB - tA;
              });
              setSavedRphList(data);
            });
            return () => unsubscribe();
          }, [user]);

          const handleInputChange = (e) => {
            const { name, value } = e.target;
            setFormData(prev => ({ ...prev, [name]: value }));
          };

          const handleApplyTemplate = (e) => {
            const templateId = e.target.value;
            if (!templateId) return;
            const t = dskpTemplates.find(x => x.id === templateId);
            if (t) {
              setFormData(prev => ({ ...prev, ...t, mataPelajaran: prev.mataPelajaran }));
              tunjukNotifikasi(`Bidang ${t.tema} dimasukkan!`);
            }
            e.target.value = "";
          };

          const handleApplyJadual = (slot) => {
            setFormData(prev => ({ ...prev, ...slot }));
            tunjukNotifikasi(`${slot.mataPelajaran} (${slot.kelas}) dipilih!`);
          };

          const handleSaveFirestore = async () => {
            if (!user) return tunjukNotifikasi('Sila tunggu log masuk...');
            setIsSaving(true);
            try {
              await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('rekod_rph').add({
                ...formData, createdAt: firebase.firestore.FieldValue.serverTimestamp()
              });
              tunjukNotifikasi('Berjaya disimpan ke awan!');
            } catch (e) { tunjukNotifikasi('Gagal menyimpan.'); }
            setIsSaving(false);
          };

          const handleDelete = async (id) => {
            try {
              await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('rekod_rph').doc(id).delete();
              tunjukNotifikasi('Dihapuskan.');
            } catch (e) { console.error(e); }
          };

          const tunjukNotifikasi = (m) => {
            setNotifikasi(m);
            setTimeout(() => setNotifikasi(''), 3000);
          };

          const handleCetak = () => window.print();

          const jadualHariIni = jadualWaktuCgMuslim[formData.hari] || [];

          return (
            <div className="min-h-screen pb-10">
              <header className="bg-indigo-800 text-white p-4 shadow-lg flex justify-between items-center no-print sticky top-0 z-50">
                <div className="flex items-center gap-3">
                  <i className="fas fa-robot text-2xl"></i>
                  <h1 className="text-xl font-bold tracking-tighter">e-RPH Pro AI</h1>
                </div>
                <div className="flex items-center gap-4">
                  {notifikasi && <span className="bg-emerald-500 px-3 py-1 rounded text-sm animate-pulse">{notifikasi}</span>}
                  <div className="bg-indigo-900 rounded p-1 flex text-xs">
                    <button onClick={()=>setViewMode('guru')} className={`px-3 py-1 rounded transition-all ${viewMode==='guru'?'bg-white text-indigo-800 shadow-sm':'text-indigo-200'}`}>Guru</button>
                    <button onClick={()=>setViewMode('admin')} className={`px-3 py-1 rounded transition-all ${viewMode==='admin'?'bg-red-500 text-white shadow-sm':'text-indigo-200'}`}>Admin</button>
                  </div>
                  <span className="text-sm font-semibold"><i className="fas fa-user-circle mr-1"></i> Ustaz Muslim bin Ab.Llah</span>
                </div>
              </header>

              <main className="max-w-7xl mx-auto mt-6 px-4">
                {viewMode === 'admin' ? (
                  <div className="bg-white p-10 rounded-2xl shadow-xl border border-indigo-50 max-w-2xl mx-auto text-center">
                    <div className="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i className="fas fa-shield-alt text-3xl text-indigo-600"></i>
                    </div>
                    <h2 className="text-2xl font-bold mb-2">Mod Pentadbir (Admin)</h2>
                    <p className="text-slate-500 mb-8 leading-relaxed">Muat naik PDF DSKP Tahun 4 & 5 untuk diekstrak oleh AI terus ke pangkalan data Firebase.</p>
                    <label className="border-2 border-dashed p-12 block rounded-2xl cursor-pointer hover:bg-slate-50 border-indigo-200 transition-all group">
                        <i className="fas fa-cloud-upload-alt text-4xl text-indigo-400 mb-3 group-hover:scale-110 transition-transform"></i>
                        <span className="block font-bold text-indigo-700">Pilih PDF DSKP</span>
                        <span className="text-xs text-slate-400 mt-1">Hanya fail .pdf sahaja</span>
                        <input type="file" className="hidden" onChange={() => setUploadStatus('AI sedang menganalisis dokumen... Berjaya mengekstrak 190 bidang!')}/>
                    </label>
                    {uploadStatus && <div className="mt-6 p-4 bg-emerald-50 text-emerald-700 text-sm rounded-xl border border-emerald-100 flex items-center justify-center gap-2">
                        <i className="fas fa-check-circle"></i> {uploadStatus}
                    </div>}
                  </div>
                ) : (
                  <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 print:block">
                    {/* INPUT SIDE */}
                    <div className="lg:col-span-5 space-y-6 no-print">
                      {/* Step 1 */}
                      <div className="bg-white p-6 rounded-2xl shadow-sm border border-indigo-50">
                        <h2 className="font-bold text-indigo-800 mb-4 uppercase tracking-tighter text-sm flex items-center"><span className="w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center mr-2 text-[10px]">1</span>Langkah 1: Tetapan Asas</h2>
                        <div className="grid grid-cols-3 gap-3 mb-4">
                          <div>
                            <label className="block text-xs font-bold text-slate-400 mb-1">Tahun</label>
                            <select name="tahun" value={formData.tahun} onChange={handleInputChange} className="w-full border p-2.5 rounded-xl bg-slate-50 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                              <option value="4">4</option><option value="5">5</option><option value="6">6</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-400 mb-1">Minggu</label>
                            <select name="minggu" value={formData.minggu} onChange={handleInputChange} className="w-full border p-2.5 rounded-xl bg-slate-50 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                              {Array.from({length:38},(_,i)=>i+1).map(m=><option key={m} value={m}>{m}</option>)}
                            </select>
                          </div>
                          <div>
                            <label className="block text-xs font-bold text-slate-400 mb-1">Hari</label>
                            <select name="hari" value={formData.hari} onChange={handleInputChange} className="w-full border p-2.5 rounded-xl bg-slate-50 text-sm focus:ring-2 focus:ring-indigo-500 outline-none font-bold">
                              {['Ahad','Isnin','Selasa','Rabu','Khamis'].map(h=><option key={h} value={h}>{h}</option>)}
                            </select>
                          </div>
                        </div>
                        {jadualHariIni.length > 0 && (
                          <div className="border-t pt-4">
                            <label className="block text-xs font-bold text-slate-400 mb-2">Pilih Kelas dari Jadual</label>
                            <select onChange={(e)=>handleApplyJadual(jadualHariIni[e.target.value])} className="w-full border-none p-3.5 rounded-xl bg-indigo-600 text-white font-bold text-sm shadow-md hover:bg-indigo-700 transition-colors">
                              <option value="">-- Pilih Kelas --</option>
                              {jadualHariIni.map((s,i)=><option key={i} value={i}>{s.masaMula} - {s.mataPelajaran} ({s.kelas})</option>)}
                            </select>
                          </div>
                        )}
                      </div>

                      {/* Step 2 */}
                      <div className="bg-white p-6 rounded-2xl shadow-sm border border-emerald-50">
                        <h2 className="font-bold text-emerald-800 mb-4 uppercase tracking-tighter text-sm flex items-center"><span className="w-6 h-6 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center mr-2 text-[10px]">2</span>Langkah 2: Pilih Bidang (AI)</h2>
                        <select onChange={handleApplyTemplate} className="w-full border-2 border-emerald-400 p-3.5 rounded-xl font-bold text-emerald-900 bg-white shadow-sm focus:ring-2 focus:ring-emerald-500 outline-none">
                          <option value="">-- Senarai Bidang Tersedia --</option>
                          {dskpTemplates.filter(t=>t.minggu===formData.minggu.toString() && t.tahun===formData.tahun.toString()).map(t=>(
                            <option key={t.id} value={t.id}>[{t.tema}] {t.tajuk}</option>
                          ))}
                        </select>
                      </div>

                      {/* Step 3 */}
                      <div className="bg-white p-6 rounded-2xl shadow-sm border">
                        <h2 className="font-bold text-slate-800 mb-4 uppercase tracking-tighter text-sm flex items-center"><span className="w-6 h-6 rounded-full bg-slate-100 text-slate-600 flex items-center justify-center mr-2 text-[10px]">3</span>Langkah 3: Edit & Simpan</h2>
                        <div className="space-y-4 text-sm">
                          <div className="grid grid-cols-2 gap-3">
                            <div>
                                <label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Bidang</label>
                                <input type="text" name="tema" value={formData.tema} onChange={handleInputChange} className="border p-2.5 rounded-xl w-full font-bold text-indigo-700 dir-rtl focus:border-indigo-500 outline-none"/>
                            </div>
                            <div>
                                <label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Tajuk</label>
                                <input type="text" name="tajuk" value={formData.tajuk} onChange={handleInputChange} className="border p-2.5 rounded-xl w-full dir-rtl focus:border-indigo-500 outline-none"/>
                            </div>
                          </div>
                          <div>
                            <label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Standard Kandungan</label>
                            <textarea name="standardKandungan" rows="2" value={formData.standardKandungan} onChange={handleInputChange} className="border p-2.5 rounded-xl w-full dir-rtl focus:border-indigo-500 outline-none text-xs leading-relaxed"></textarea>
                          </div>
                          <div>
                            <label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Standard Pembelajaran</label>
                            <textarea name="standardPembelajaran" rows="2" value={formData.standardPembelajaran} onChange={handleInputChange} className="border p-2.5 rounded-xl w-full dir-rtl focus:border-indigo-500 outline-none text-xs leading-relaxed"></textarea>
                          </div>
                          <div>
                            <label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Objektif Pembelajaran</label>
                            <textarea name="objektif" rows="2" value={formData.objektif} onChange={handleInputChange} className="border p-2.5 rounded-xl w-full dir-rtl focus:border-indigo-500 outline-none text-xs leading-relaxed"></textarea>
                          </div>
                          <div>
                            <label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Aktiviti PdP</label>
                            <textarea name="aktiviti" rows="5" value={formData.aktiviti} onChange={handleInputChange} className="border p-2.5 rounded-xl w-full dir-rtl focus:border-indigo-500 outline-none text-xs leading-relaxed"></textarea>
                          </div>
                          <div className="grid grid-cols-2 gap-3">
                            <div>
                                <label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase">BBM</label>
                                <input type="text" name="bbm" value={formData.bbm} onChange={handleInputChange} className="border p-2.5 rounded-xl w-full dir-rtl focus:border-indigo-500 outline-none"/>
                            </div>
                            <div>
                                <label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Refleksi</label>
                                <textarea name="refleksi" rows="2" value={formData.refleksi} onChange={handleInputChange} className="border p-2.5 rounded-xl w-full focus:border-indigo-500 outline-none text-xs"></textarea>
                            </div>
                          </div>
                        </div>
                        <div className="flex gap-3 mt-6">
                          <button onClick={handleSaveFirestore} disabled={isSaving} className="flex-1 bg-indigo-600 text-white py-3.5 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-md active:scale-95 disabled:opacity-50">
                            <i className="fas fa-cloud-upload-alt mr-2"></i> {isSaving ? 'Menyimpan...':'Simpan ke Firebase'}
                          </button>
                          <button onClick={handleCetak} className="bg-slate-800 text-white px-8 rounded-xl hover:bg-slate-900 transition-all shadow-md active:scale-95">
                            <i className="fas fa-print"></i>
                          </button>
                        </div>
                      </div>

                      {/* Saved Archives */}
                      <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h2 className="font-bold text-slate-400 mb-4 uppercase tracking-tighter text-[10px] flex items-center justify-between">
                            <span>Arkib RPH Saya</span>
                            <span className="bg-slate-100 px-2 py-0.5 rounded text-slate-500">{savedRphList.length} rekod</span>
                        </h2>
                        <div className="max-h-80 overflow-y-auto space-y-2 pr-2">
                          {savedRphList.map(r=>(
                            <div key={r.id} className="flex justify-between items-center p-3 border border-slate-100 rounded-xl hover:bg-slate-50 text-xs transition-colors group">
                              <div onClick={()=>setFormData(r)} className="cursor-pointer flex-1">
                                <div className="font-bold text-slate-700 group-hover:text-indigo-600">M{r.minggu}: {r.tema}</div>
                                <div className="text-slate-400 mt-1 flex gap-2"><span>{r.tarikh}</span> <span>•</span> <span>{r.kelas}</span></div>
                              </div>
                              <button onClick={()=>handleDelete(r.id)} className="text-slate-300 hover:text-red-500 transition-colors p-2"><i className="fas fa-trash-alt"></i></button>
                            </div>
                          ))}
                          {savedRphList.length === 0 && <p className="text-center py-6 text-slate-400 italic">Belum ada rekod disimpan.</p>}
                        </div>
                      </div>
                    </div>

                    {/* PREVIEW SIDE (Kertas A4) */}
                    <div className="lg:col-span-7 bg-white p-12 shadow-2xl rounded-sm border min-h-[1100px] relative print:p-0 print:shadow-none print:border-none print:m-0">
                      <div className="absolute top-0 right-0 p-2 bg-slate-800 text-white text-[10px] uppercase font-bold no-print rounded-bl">Pratonton Kertas A4</div>
                      
                      {/* Header Sekolah */}
                      <div className="text-center border-b-2 border-slate-800 pb-6 mb-8 flex flex-col items-center justify-center relative">
                        <img src="logo.png" className="w-20 h-20 mb-2 object-contain" alt="Logo" onError={(e)=>e.target.style.display='none'} />
                        <h1 className="text-2xl font-bold uppercase tracking-widest text-slate-900">Rancangan Pelajaran Harian</h1>
                        <p className="text-md font-bold text-slate-600 mt-1">SK PERMAISURI NUR ZAHIRAH</p>
                        <div className="mt-4 px-6 py-1.5 border-2 border-slate-800 font-bold uppercase text-sm inline-block">
                            {formData.mataPelajaran} (TAHUN {formData.tahun})
                        </div>
                      </div>

                      {/* Details Grid */}
                      <div className="grid grid-cols-2 gap-x-10 gap-y-4 mb-8 text-sm border-b pb-6">
                        <div className="flex border-b border-slate-200 pb-1.5 items-center"><span className="w-24 font-bold text-slate-400 text-xs uppercase">Minggu</span><span className="font-bold text-slate-800">{formData.minggu}</span></div>
                        <div className="flex border-b border-slate-200 pb-1.5 items-center"><span className="w-24 font-bold text-slate-400 text-xs uppercase">Tarikh</span><span className="font-bold text-slate-800">{formData.tarikh} ({formData.hari})</span></div>
                        <div className="flex border-b border-slate-200 pb-1.5 items-center"><span className="w-24 font-bold text-slate-400 text-xs uppercase">Masa</span><span className="font-bold text-slate-800">{formData.masaMula} - {formData.masaTamat}</span></div>
                        <div className="flex border-b border-slate-200 pb-1.5 items-center"><span className="w-24 font-bold text-slate-400 text-xs uppercase">Kelas</span><span className="font-bold text-slate-800">{formData.kelas}</span></div>
                        <div className="flex border-b border-slate-200 pb-1.5 items-center col-span-2"><span className="w-24 font-bold text-slate-400 text-xs uppercase">Kehadiran</span><span className="font-bold text-slate-800">____ / ____ Murid</span></div>
                      </div>

                      {/* Content Area */}
                      <div className="space-y-6 text-sm">
                        <div className="grid grid-cols-12 gap-4">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs tracking-widest pt-1">Bidang</div>
                            <div className="col-span-9 font-bold text-xl text-indigo-900 dir-rtl">{formData.tema || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs tracking-widest pt-1">Tajuk</div>
                            <div className="col-span-9 font-bold text-lg dir-rtl">{formData.tajuk || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 bg-slate-50 p-4 rounded-xl print:bg-transparent print:p-0 print:border-b">
                            <div className="col-span-3 font-bold text-[10px] uppercase text-slate-400 tracking-tighter pt-1">Standard Kandungan</div>
                            <div className="col-span-9 whitespace-pre-line leading-loose font-medium dir-rtl">{formData.standardKandungan || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 bg-slate-50 p-4 rounded-xl print:bg-transparent print:p-0 print:border-b">
                            <div className="col-span-3 font-bold text-[10px] uppercase text-slate-400 tracking-tighter pt-1">Standard Pembelajaran</div>
                            <div className="col-span-9 whitespace-pre-line leading-loose font-medium dir-rtl">{formData.standardPembelajaran || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs pt-1">Objektif</div>
                            <div className="col-span-9 whitespace-pre-line leading-relaxed font-semibold dir-rtl">{formData.objektif || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 border-t border-slate-100 pt-5">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs pt-1">Aktiviti PdP</div>
                            <div className="col-span-9 whitespace-pre-line leading-relaxed dir-rtl text-slate-700">{formData.aktiviti || '-'}</div>
                        </div>
                        <div className="grid grid-cols-12 gap-4 border-t border-slate-100 pt-5">
                            <div className="col-span-3 font-bold uppercase text-slate-400 text-xs pt-1">BBM</div>
                            <div className="col-span-9 font-bold text-slate-800 dir-rtl">{formData.bbm || '-'}</div>
                        </div>
                        <div className="mt-12 border-2 border-slate-800 p-6 rounded-sm min-h-[150px] relative">
                            <h3 className="absolute -top-3 left-4 bg-white px-2 font-bold text-[10px] uppercase text-slate-900 tracking-widest italic">Refleksi / Catatan</h3>
                            <p className="italic text-slate-700 leading-relaxed whitespace-pre-line">{formData.refleksi || 'Murid-murid memberikan respons yang baik terhadap pengajaran dan mencapai objektif yang ditetapkan.'}</p>
                        </div>
                      </div>

                      {/* Signatures */}
                      <div className="mt-24 grid grid-cols-2 gap-12 text-center text-[10px] print:grid hidden">
                        <div>
                            <div className="border-b border-slate-800 mx-10 mb-2 h-16"></div>
                            <p className="font-bold">Tandatangan Guru</p>
                            <p className="uppercase font-bold mt-1">(USTAZ MUSLIM BIN AB.LLAH)</p>
                        </div>
                        <div>
                            <div className="border-b border-slate-800 mx-10 mb-2 h-16"></div>
                            <p className="font-bold">Disemak Oleh</p>
                            <p className="uppercase font-bold mt-1">(GURU BESAR / PK PENTADBIRAN)</p>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </main>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>